--- a/net/minecraft/world/level/block/EndPortalBlock.java
+++ b/net/minecraft/world/level/block/EndPortalBlock.java
@@ -46,10 +_,26 @@
          ResourceKey<Level> resourcekey = p_53026_.dimension() == Level.END ? Level.OVERWORLD : Level.END;
          ServerLevel serverlevel = ((ServerLevel)p_53026_).getServer().getLevel(resourcekey);
          if (serverlevel == null) {
+         }
+
+         // CraftBukkit start - Entity in portal
+         EntityPortalEnterEvent event = new EntityPortalEnterEvent(p_53028_.getBukkitEntity(), new org.bukkit.Location(p_53026_.getWorld(), p_53027_.getX(), p_53027_.getY(), p_53027_.getZ()));
+         p_53026_.getCraftServer().getPluginManager().callEvent(event);
+
+         if (p_53028_ instanceof ServerPlayer player) {
+            // Mohist  start - fix bukkit allow end
+            if (p_53026_.getCraftServer().getAllowEnd()) {
+               player.changeDimension(serverlevel, PlayerTeleportEvent.TeleportCause.END_PORTAL);
+            }else {
+               player.displayClientMessage(Component.literal("End dimension is not allow at this server"), true);
+            }
             return;
          }
-
-         p_53028_.changeDimension(serverlevel);
+         // CraftBukkit end
+         if (p_53026_.getCraftServer().getAllowEnd()) {
+            // Mohist end
+            p_53028_.changeDimension(serverlevel);
+         }
       }
 
    }
